<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kosen Learning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .prose h2 { font-size: 1.4em; font-weight: bold; margin-top: 1em; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.2em; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin: 1em 0; }
        .prose pre { background: #1e293b; color: #fff; padding: 1em; border-radius: 0.5em; overflow-x: auto; }
        .katex { font-size: 1.1em; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col">

    <nav class="bg-indigo-700 text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-6">
                <a href="/" class="text-xl font-bold tracking-wider flex items-center gap-2 hover:opacity-90">
                    ğŸ“ Kosen Hub
                </a>
                {% if session.get('role') == 'student' %}
                <a href="/tools" class="text-sm font-bold bg-indigo-800/50 px-3 py-1.5 rounded hover:bg-indigo-600 transition flex items-center gap-1">
                    ğŸ› ï¸ è‡ªç”±å­¦ç¿’ãƒ„ãƒ¼ãƒ«
                </a>
                {% endif %}
            </div>
            
            <div class="flex items-center gap-4">
                {% if session.get('user_id') %}
                    <a href="/switch_role" class="text-xs font-bold bg-white/20 hover:bg-white/30 text-white px-3 py-1.5 rounded transition flex items-center gap-1 border border-white/30" title="ãƒ‡ãƒ¢ç”¨: å…ˆç”Ÿã¨å­¦ç”Ÿã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™">
                        ğŸ”„ {{ 'å­¦ç”Ÿã¸åˆ‡æ›¿' if session.get('role') == 'teacher' else 'å…ˆç”Ÿã¸åˆ‡æ›¿' }}
                    </a>

                    <span class="text-xs font-semibold bg-indigo-900 px-3 py-1 rounded-full border border-indigo-500">
                        {{ 'ğŸ‘¨â€ğŸ« æ•™å“¡' if session.get('role') == 'teacher' else 'ğŸ§‘â€ğŸ“ å­¦ç”Ÿ' }}
                    </span>
                    <a href="/logout" class="text-sm hover:text-indigo-200 transition">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8 flex-grow">
        {% block content %}{% endblock %}
    </main>

    <footer class="bg-slate-800 text-slate-400 text-center py-4 mt-auto">
        <p class="text-xs">&copy; 2025 Kosen PBL Project. Powered by Gemini 3.0</p>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false}
                ],
                throwOnError: false
            });
        });

        // â˜…æ–°è¦è¿½åŠ : èª­ã¿ä¸Šã’æ©Ÿèƒ½ (ä¼šè©±é€Ÿåº¦: 1.2å€)
        function speakText(text) {
            // ç¾åœ¨ã®èª­ã¿ä¸Šã’ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            window.speechSynthesis.cancel();

            // ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰Markdownè¨˜å·ãªã©ã‚’ç°¡æ˜“çš„ã«é™¤å»ï¼ˆèª­ã¿ä¸Šã’ã‚„ã™ãã™ã‚‹ï¼‰
            const cleanText = text.replace(/[#*`\-]/g, '');

            const uttr = new SpeechSynthesisUtterance(cleanText);
            uttr.lang = 'ja-JP';
            uttr.rate = 1.2; // å°‘ã—é€Ÿã‚ï¼ˆè‡ªç„¶ãªä¼šè©±é€Ÿåº¦ï¼‰
            uttr.pitch = 1.0;
            window.speechSynthesis.speak(uttr);
        }
    </script>
</body>
</html>